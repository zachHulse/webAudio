<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Song</title>
  <script src="synth.js"></script>
  <script src="drums.js"></script>
</head>
<style>
  select:hover {
    cursor: pointer;
  }
  button:hover {
    cursor: pointer;
  }
</style>
<body>
<h1><a href="start.html">Song</a></h1>
<div class="heading">
  <span>Select Melody/Rhythm</span> | <span>Select Starting Measure</span> | <span>Select Duration</span>
</div>
<div class="options"></div>

<button class="play">Play</button>
</body>
</html>

<script>
  window.onload = function () {
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();

    const synth = new Synth(audioContext);
    const drums = new Drums(audioContext);

    const options = document.querySelector('.options');

    const elements = '<select class="sound">' +
      '<option></option>' +
      '<option value="song1">Melody 1</option> ' +
      '<option value="song2">Melody 2</option> ' +
      '<option value="song3">Melody 3</option> ' +
      '<option value="song4">Melody 4</option> ' +
      '<option value="drum1">Rhythm 1</option> ' +
      '<option value="drum2">Rhythm 2</option> ' +
      '<option value="drum3">Rhythm 3</option> ' +
      '<option value="drum4">Rhythm 4</option> ' +
      '</select>' +
      '<select class="start" style="margin-left: 76px">' +
      '<option value="0">1</option>' +
      '<option value="8">5</option>' +
      '<option value="16">9</option>' +
      '<option value="24">13</option>' +
      '<option value="32">17</option>' +
      '<option value="40">21</option>' +
      '<option value="48">25</option>' +
      '<option value="14">29</option>' +
      '<option value="16">33</option>' +
      '<option value="18">37</option>' +
      '<option value="20">41</option>' +
      '<option value="22">45</option>' +
      '<option value="24">49</option>' +
      '<option value="26">53</option>' +
      '<option value="28">57</option>' +
      '<option value="30">61</option>' +
      '</select>' +
      '<select class="duration" style="margin-left: 118px">' +
      '<option value="0">0</option>' +
      '<option value="1">4</option>' +
      '<option value="2">8</option>' +
      '<option value="3">12</option>' +
      '<option value="4">16</option>' +
      '</select><br />';
      for(let i = 0; i < 16; i++) {
        options.insertAdjacentHTML('beforeend', elements);
      }

    document.querySelector('.play').addEventListener('click', () => {
      let now = audioContext.currentTime;
      let sounds = document.querySelectorAll('.sound');
      let starts = document.querySelectorAll('.start');
      let durations = document.querySelectorAll('.duration');

      for(let i = 0; i < 16; i++) {

        switch(sounds[i].value) {
          case 'drum1':
            for(let j = 0; j < Number(durations[i].value); j++) {
              drums.playLoop(now + Number(starts[i].value) + 8 * j, 'track1', 'fill3');
            }
            break;
          case 'drum2':
            for(let j = 0; j < Number(durations[i].value); j++) {
              drums.playLoop(now + Number(starts[i].value) + 8 * j, 'track2', 'fill4');
            }
            break;
          case 'drum3':
            for(let j = 0; j < Number(durations[i].value); j++) {
              drums.playLoop(now + Number(starts[i].value) + 8 * j, 'track3', 'fill2');
            }
            break;
          case 'drum4':
            for(let j = 0; j < Number(durations[i].value); j++) {
              drums.playLoop(now + Number(starts[i].value) + 8 * j, 'track4', 'fill1');
            }
              break;
          case 'song1':
            for(let j = 0; j < Number(durations[i].value); j++) {
              synth.playLoop(now + Number(starts[i].value) + 8 * j, 'melody1');
            }
            break;
          case 'song2':
            for(let j = 0; j < Number(durations[i].value); j++) {
              synth.playLoop(now + Number(starts[i].value) + 8 * j, 'melody2');
            }
            break;
          case 'song3':
            for(let j = 0; j < Number(durations[i].value); j++) {
              synth.playLoop(now + Number(starts[i].value) + 8 * j, 'melody3');
            }
            break;
          case 'song4':
            for(let j = 0; j < Number(durations[i].value); j++) {
              synth.playLoop(now + Number(starts[i].value) + 8 * j, 'melody4');
            }
            break;
        }
      }
    });
  };
</script>